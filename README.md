# Device Detector sevice

## Running
```bash
docker compose up --build -d
```

## Request example
```bash
curl 'http://localhost:9501/detect?ua=Mozilla%2F5.0+%28X11%3B+Ubuntu%3B+Linux+x86_64%3B+rv%3A137.0%29+Gecko%2F20100101+Firefox%2F137.0'
```


## Example wrk2 run

```bash
 wrk -c 5 -t 5 -d 5s -L -R 4000 'http://localhost:9501/detect?ua=Mozilla%2F5.0+%28X11%3B+Ubuntu%3B+Linux+x86_64%3B+rv%3A137.0%29+Gecko%2F20100101+Firefox%2F137.0'
Running 5s test @ http://localhost:9501/detect?ua=Mozilla%2F5.0+%28X11%3B+Ubuntu%3B+Linux+x86_64%3B+rv%3A137.0%29+Gecko%2F20100101+Firefox%2F137.0
  5 threads and 5 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   140.58ms   57.19ms 247.68ms   67.41%
    Req/Sec       -nan      -nan   0.00      0.00%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%  137.98ms
 75.000%  186.49ms
 90.000%  214.65ms
 99.000%  243.46ms
 99.900%  246.65ms
 99.990%  247.55ms
 99.999%  247.81ms
100.000%  247.81ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       1.639     0.000000            1         1.00
      75.327     0.100000         1905         1.11
      87.871     0.200000         3810         1.25
     105.983     0.300000         5720         1.43
     119.231     0.400000         7624         1.67
     137.983     0.500000         9528         2.00
     156.927     0.550000        10483         2.22
     165.759     0.600000        11452         2.50
     172.927     0.650000        12383         2.86
     179.455     0.700000        13350         3.33
     186.495     0.750000        14297         4.00
     191.359     0.775000        14770         4.44
     195.071     0.800000        15251         5.00
     198.527     0.825000        15721         5.71
     202.751     0.850000        16202         6.67
     209.407     0.875000        16672         8.00
     212.223     0.887500        16918         8.89
     214.655     0.900000        17168        10.00
     218.495     0.912500        17386        11.43
     222.591     0.925000        17628        13.33
     225.535     0.937500        17882        16.00
     226.175     0.943750        17981        17.78
     227.455     0.950000        18117        20.00
     228.479     0.956250        18233        22.86
     230.655     0.962500        18339        26.67
     233.343     0.968750        18466        32.00
     234.239     0.971875        18516        35.56
     237.567     0.975000        18579        40.00
     238.591     0.978125        18634        45.71
     239.871     0.981250        18696        53.33
     241.279     0.984375        18755        64.00
     242.047     0.985938        18784        71.11
     242.943     0.987500        18820        80.00
     243.199     0.989062        18846        91.43
     244.095     0.990625        18873       106.67
     244.479     0.992188        18905       128.00
     244.863     0.992969        18929       142.22
     244.991     0.993750        18946       160.00
     244.991     0.994531        18946       182.86
     245.119     0.995313        18970       213.33
     245.247     0.996094        18981       256.00
     245.375     0.996484        18985       284.44
     245.503     0.996875        18998       320.00
     245.503     0.997266        18998       365.71
     245.759     0.997656        19006       426.67
     246.143     0.998047        19017       512.00
     246.143     0.998242        19017       568.89
     246.271     0.998437        19021       640.00
     246.527     0.998633        19026       731.43
     246.655     0.998828        19031       853.33
     246.783     0.999023        19033      1024.00
     246.911     0.999121        19036      1137.78
     246.911     0.999219        19036      1280.00
     247.039     0.999316        19042      1462.86
     247.039     0.999414        19042      1706.67
     247.039     0.999512        19042      2048.00
     247.039     0.999561        19042      2275.56
     247.167     0.999609        19046      2560.00
     247.167     0.999658        19046      2925.71
     247.167     0.999707        19046      3413.33
     247.167     0.999756        19046      4096.00
     247.167     0.999780        19046      4551.11
     247.295     0.999805        19047      5120.00
     247.295     0.999829        19047      5851.43
     247.551     0.999854        19048      6826.67
     247.551     0.999878        19048      8192.00
     247.551     0.999890        19048      9102.22
     247.807     0.999902        19050     10240.00
     247.807     1.000000        19050          inf
#[Mean    =      140.584, StdDeviation   =       57.191]
#[Max     =      247.680, Total count    =        19050]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  19055 requests in 5.00s, 7.63MB read
Requests/sec:   3810.74
Transfer/sec:      1.53MB
```

## Example wrk2 run with ua_bench.lua

Results for cold run (no cache involved):

```bash
wrk -c 6 -t 6 -d 5s -L -R 1000 -s ua_bench.lua 'http://localhost:9501'
Running 5s test @ http://localhost:9501
  6 threads and 6 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     2.53ms    3.60ms  41.95ms   97.44%
    Req/Sec       -nan      -nan   0.00      0.00%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.77ms
 75.000%    2.10ms
 90.000%    3.74ms
 99.000%   25.25ms
 99.900%   37.89ms
 99.990%   41.98ms
 99.999%   41.98ms
100.000%   41.98ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       1.008     0.000000            1         1.00
       1.315     0.100000          502         1.11
       1.442     0.200000         1002         1.25
       1.560     0.300000         1503         1.43
       1.653     0.400000         2002         1.67
       1.767     0.500000         2499         2.00
       1.827     0.550000         2755         2.22
       1.888     0.600000         3002         2.50
       1.948     0.650000         3251         2.86
       2.018     0.700000         3499         3.33
       2.101     0.750000         3754         4.00
       2.157     0.775000         3874         4.44
       2.261     0.800000         4000         5.00
       2.877     0.825000         4125         5.71
       3.279     0.850000         4249         6.67
       3.509     0.875000         4374         8.00
       3.613     0.887500         4438         8.89
       3.743     0.900000         4499        10.00
       3.859     0.912500         4561        11.43
       3.951     0.925000         4624        13.33
       4.089     0.937500         4686        16.00
       4.167     0.943750         4720        17.78
       4.215     0.950000         4750        20.00
       4.303     0.956250         4780        22.86
       4.427     0.962500         4811        26.67
       4.671     0.968750         4842        32.00
       4.923     0.971875         4858        35.56
       7.495     0.975000         4874        40.00
      11.903     0.978125         4889        45.71
      14.823     0.981250         4905        53.33
      18.639     0.984375         4920        64.00
      20.719     0.985938         4928        71.11
      22.575     0.987500         4936        80.00
      24.223     0.989062         4944        91.43
      26.607     0.990625         4952       106.67
      27.567     0.992188         4959       128.00
      28.127     0.992969         4963       142.22
      28.495     0.993750         4967       160.00
      30.383     0.994531         4971       182.86
      32.143     0.995313         4975       213.33
      32.671     0.996094         4979       256.00
      32.799     0.996484         4981       284.44
      33.247     0.996875         4983       320.00
      33.471     0.997266         4985       365.71
      35.775     0.997656         4987       426.67
      36.287     0.998047         4989       512.00
      37.183     0.998242         4990       568.89
      37.375     0.998437         4991       640.00
      37.759     0.998633         4992       731.43
      37.887     0.998828         4993       853.33
      37.951     0.999023         4994      1024.00
      37.951     0.999121         4994      1137.78
      38.015     0.999219         4995      1280.00
      38.015     0.999316         4995      1462.86
      38.271     0.999414         4996      1706.67
      38.271     0.999512         4996      2048.00
      38.271     0.999561         4996      2275.56
      41.663     0.999609         4997      2560.00
      41.663     0.999658         4997      2925.71
      41.663     0.999707         4997      3413.33
      41.663     0.999756         4997      4096.00
      41.663     0.999780         4997      4551.11
      41.983     0.999805         4998      5120.00
      41.983     1.000000         4998          inf
#[Mean    =        2.525, StdDeviation   =        3.600]
#[Max     =       41.952, Total count    =         4998]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  5004 requests in 5.00s, 2.00MB read
Requests/sec:   1000.88
Transfer/sec:    409.15KB
```
